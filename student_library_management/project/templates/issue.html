{% extends "base.html" %}
{% block content %}
<h2>Issue / Return</h2>

{% if session.role == 'librarian' %}
<form method="post" action="{{ url_for('issue_book') }}" class="row g-2 mb-3">
  <div class="col">
    <select class="form-select" name="student_id" required>
      <option value="">Select Student</option>
      {% for s in students %}<option value="{{ s.student_id }}">{{ s.name }}</option>{% endfor %}
    </select>
  </div>
  <div class="col">
    <select class="form-select" name="book_id" required>
      <option value="">Select Book</option>
      {% for b in books %}<option value="{{ b.book_id }}">{{ b.title }}</option>{% endfor %}
    </select>
  </div>
  <div class="col-auto"><button class="btn btn-primary">Issue</button></div>
</form>
{% endif %}

<table class="table table-bordered">
  <thead><tr><th>ID</th><th>Student</th><th>Book</th><th>Issue Date</th><th>Return Date</th><th>Action</th></tr></thead>
  <tbody>
    {% for r in records %}
      <tr>
        <td>{{ r.issue_id }}</td>
        <td>{{ r.student_name }}</td>
        <td>{{ r.book_title }}</td>
        <td>{{ r.issue_date }}</td>
        <td>{{ r.return_date if r.return_date else 'Not Returned' }}</td>
        <td>
          {% if not r.return_date and session.role == 'librarian' %}
            <a class="btn btn-sm btn-success" href="{{ url_for('return_book', issue_id=r.issue_id) }}">Return</a>
          {% else %}
            {% if r.return_date %}Returned{% else %}â€”{% endif %}
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
